# 문제 7: Implicit FDM 이산화 (20점)

## 📚 강의 노트 참조
- **Lecture 03: Finite Difference Methods**
  - p.8-10: Implicit method derivation
  - p.11-13: Boundary condition treatment
  - p.14-15: θ-methods and stability
  - p.16: Barrier option pricing

---

## 📋 원본 문제

> **문제 7 (20점)**
>
> 다음 PDE를 Implicit FDM으로 이산화한다:
>
> $$V_t + aV_{SS} + bV_S + cV = 0$$
>
> 그리드:
> - $S = S_{min} + i \cdot \Delta S$ $(i = 0, 1, \ldots, N)$
> - $t = T - k \cdot \Delta t$ $(k = 0, 1, \ldots, M)$
> - $v_i^k = V(S_i, t_k)$
>
> **(1)** 내부점 $(1 \leq i \leq N-1)$에서 $v_i^{k+1}$과 $v_i^k$의 관계식을 유도하시오. (5점)
>
> **(2)** 경계조건이 $V_{SS} = 0$일 때, $i=1$과 $i=N-1$에서의 관계식을 구하시오. (각 5점)
>
> **(3)** Down-and-Out 배리어 옵션에서 $S_{min}$이 녹아웃 배리어일 때, $i=1$에서의 관계식을 구하시오. (5점)

---

## 🗺️ 청사진: 이 문제가 뭘 하려는 건가?

### 최종 목표

PDE를 풀어서 **모든 격자점의 옵션 가격**을 구하고 싶음

### 격자 구조와 "내부점"

```
S (주가)
  ↑
S_max ── i=N ────●────●────●────●──  ← 경계점 (별도 조건으로 지정)
                 │    │    │    │
         i=N-1 ──●────●────●────●──  ┐
                 │    │    │    │    │
         ...     ●────●────●────●──  │ 내부점: PDE로 "계산"할 점들
                 │    │    │    │    │
         i=1  ───●────●────●────●──  ┘
                 │    │    │    │
S_min ── i=0 ────●────●────●────●──  ← 경계점 (별도 조건으로 지정)
                k=0  k=1  k=2  k=3   → 시간 (만기→현재)
```

- **내부점** (1 ≤ i ≤ N-1): PDE가 적용되는 곳 → **(1)번**에서 관계식 유도
- **경계점** (i=0, i=N): PDE 밖, 별도 조건 필요 → **(2), (3)번**에서 처리

### (1), (2), (3)의 역할

```
┌─────────────────────────────────────────────────────────────────┐
│ (1) 내부점 관계식                                                │
│     "PDE를 차분 방정식으로 바꾸면 어떻게 생겼나?"                  │
│     → 기본 레시피. 하지만 i=1에서 v₀, i=N-1에서 v_N이 필요!      │
├─────────────────────────────────────────────────────────────────┤
│ (2) 경계조건 V_SS = 0                                           │
│     "v₀과 v_N을 어떻게 처리하나?"                                │
│     → 경계조건으로 v₀, v_N을 내부점으로 표현 → 방정식 완성        │
├─────────────────────────────────────────────────────────────────┤
│ (3) 배리어 옵션 경계조건                                         │
│     "다른 종류의 경계조건이면?"                                   │
│     → v₀ = 0 (녹아웃) → 더 단순한 관계식                        │
└─────────────────────────────────────────────────────────────────┘
```

### 왜 "관계식"이 필요한가?

Implicit 방법: k+1 시점 값들이 **서로 엮여 있음**

```
알고 있음:    v₁ᵏ,  v₂ᵏ,  v₃ᵏ, ...
                ↑     ↑     ↑
              (연립방정식으로 연결)
                ↓     ↓     ↓
구하고 싶음:  v₁ᵏ⁺¹, v₂ᵏ⁺¹, v₃ᵏ⁺¹, ...
```

→ 관계식들을 모아서 **연립방정식**을 만들고, 한꺼번에 풀어야 함!

---

## 🎯 배경지식: Black-Scholes PDE 이해하기

### 먼저, 옵션이 뭔가요?

**옵션** = 미래에 주식을 특정 가격에 살 수 있는 **권리**

```
예시: 삼성전자 콜옵션

현재 주가: 70,000원
행사가(K): 75,000원
만기: 3개월 후

3개월 후 삼성전자가...
  80,000원이면 → 75,000원에 사서 팔면 5,000원 이익! 💰
  70,000원이면 → 권리 포기 (손해 0원)

질문: 이 "권리"의 오늘 가치는?
```

### Black-Scholes 방정식

1973년, Black과 Scholes가 옵션 가격이 만족하는 방정식을 발견:

$$\frac{\partial V}{\partial t} + \frac{1}{2}\sigma^2 S^2 \frac{\partial^2 V}{\partial S^2} + rS\frac{\partial V}{\partial S} - rV = 0$$

### 각 항의 의미 (하나씩 이해하기)

#### 1️⃣ $\frac{\partial V}{\partial t}$ : 시간 변화

```
"시간이 지나면 옵션 가치가 어떻게 변하나?"

만기까지 남은 시간이 줄어들면...
→ 주가가 오를 "기회"가 줄어듦
→ 옵션의 시간가치 감소 (Time Decay)

비유: 복권 추첨일이 다가올수록 "혹시 될지도?"의 가치 감소
```

#### 2️⃣ $\frac{1}{2}\sigma^2 S^2 \frac{\partial^2 V}{\partial S^2}$ : 변동성 효과

```
"주가가 출렁일 때 옵션 가치가 얼마나 변하나?"

σ (시그마) = 변동성 = 주가가 얼마나 출렁이나
S = 현재 주가
∂²V/∂S² = 감마(Γ) = 옵션 가격의 곡률

변동성이 크면...
→ 주가가 크게 오를 확률도 높음
→ 콜옵션 보유자에게 유리! (손실은 제한, 이익은 무제한)
→ 옵션 가치 상승
```

#### 3️⃣ $rS\frac{\partial V}{\partial S}$ : 드리프트 효과

```
"평균적으로 주가는 무위험 이자율만큼 상승"

r = 무위험 이자율 (예: 국채 금리 3%)
∂V/∂S = 델타(Δ) = 주가 변화에 대한 민감도

주가가 오르면 콜옵션 가치도 오름
```

#### 4️⃣ $-rV$ : 할인 효과

```
"미래 가치를 현재 가치로 할인"

미래의 1,000원 ≠ 오늘의 1,000원
→ 무위험 이자율로 할인
```

---

### Greeks (그릭스): 옵션의 민감도 지표

PDE의 각 편미분은 **Greeks**라 불리는 중요한 지표들입니다.

#### 왜 Greeks인가?

그리스 문자로 표기해서 Greeks라 부릅니다. 옵션 가격이 **각 요인에 얼마나 민감한지** 측정합니다.

#### 주요 Greeks 정리

| Greek | 기호 | 정의 | 의미 | 비유 |
|-------|-----|------|------|------|
| **Delta** | $\Delta$ | $\frac{\partial V}{\partial S}$ | 주가 변화에 대한 민감도 | "주가 1원 오르면 옵션 얼마나 오르나?" |
| **Gamma** | $\Gamma$ | $\frac{\partial^2 V}{\partial S^2}$ | Delta의 변화율 (곡률) | "Delta가 얼마나 빨리 변하나?" |
| **Theta** | $\Theta$ | $\frac{\partial V}{\partial t}$ | 시간에 대한 민감도 | "하루 지나면 옵션 얼마나 감소하나?" |
| **Vega** | $\nu$ | $\frac{\partial V}{\partial \sigma}$ | 변동성에 대한 민감도 | "변동성 1% 오르면 옵션 얼마나 오르나?" |
| **Rho** | $\rho$ | $\frac{\partial V}{\partial r}$ | 금리에 대한 민감도 | "금리 1% 오르면 옵션 얼마나 변하나?" |

#### 그림으로 이해하는 Delta와 Gamma

```
옵션 가격 V
     ↑
     │                    ╭────── 콜옵션 가격 곡선
     │                 ╭──╯
     │              ╭──╯
     │           ╭──╯
     │        ╭──╯        ← 이 기울기 = Delta (Δ)
     │     ╭──╯
     │  ───╯              ← 곡선의 휘어진 정도 = Gamma (Γ)
     │
     └─────────────────────────→ 주가 S
              K (행사가)

Delta (Δ) = 접선의 기울기
  - S < K (OTM): Delta ≈ 0 (주가 올라도 옵션 가치 거의 안 변함)
  - S = K (ATM): Delta ≈ 0.5
  - S > K (ITM): Delta ≈ 1 (주가 1원 오르면 옵션도 1원 오름)

Gamma (Γ) = 곡률 = Delta가 변하는 속도
  - ATM 근처에서 가장 큼 (곡선이 가장 많이 휘어짐)
  - Deep ITM/OTM에서 작음 (거의 직선)
```

#### Greeks와 Black-Scholes PDE의 관계

$$\underbrace{\Theta}_{V_t} + \frac{1}{2}\sigma^2 S^2 \underbrace{\Gamma}_{V_{SS}} + rS\underbrace{\Delta}_{V_S} - rV = 0$$

이 방정식이 말하는 것:

```
"옵션의 시간가치 감소(Θ)는
 변동성으로 인한 이득(½σ²S²Γ)과
 주가 상승으로 인한 이득(rSΔ)에서
 할인 비용(rV)을 뺀 것과 균형을 이룬다"
```

#### 트레이더가 Greeks를 쓰는 이유: Delta Hedging

##### Step 1: 쉬운 예시부터

```
공매도란?

보통: 100원에 사서 → 150원에 판다 → 50원 이익 (오르면 이익)
공매도: 100원에 빌려서 판다 → 80원에 사서 갚는다 → 20원 이익 (내리면 이익)
```

```
Delta = 100 이란?

주가 +1원 → 내 수익 +100원
주가 -1원 → 내 손실 -100원

"주가 방향에 베팅하고 있는 상태"
```

##### Step 2: 왜 균형을 맞추나?

```
비유: 시소 균형

    옵션 (+100)
        ●
        │
────────┴────────   ← 기울어짐 (위험!)


    옵션 (+100)         공매도 (-100)
        ●                    ●
────────┴────────────────────┴────  ← 균형!

```

주가 방향 위험을 없애고, **다른 요소(변동성 등)에만 베팅**하고 싶을 때 사용

##### Step 3: 수학적 표현

포트폴리오 가치 $\Pi$가 옵션 $V$와 주식 $-\Delta$주로 구성:

$$\Pi = V - \Delta \cdot S$$

포트폴리오의 주가 민감도:

$$\frac{\partial \Pi}{\partial S} = \frac{\partial V}{\partial S} - \Delta = \Delta - \Delta = 0$$

##### Step 4: "Delta = 0이면 왜 무위험?"

**"무위험" = 주가가 어디로 가든 상관없다**

```
예시:
- 콜옵션 1개 (Delta = +0.5)
- 주식 0.5주 공매도 (Delta = -0.5)
- 포트폴리오 Delta = 0

주가 101원:
  옵션: +0.5원, 공매도: -0.5원 → 합계: 0원

주가 99원:
  옵션: -0.5원, 공매도: +0.5원 → 합계: 0원

→ 주가가 어디로 가든 변화 없음 = 무위험!
```

**주의**: Delta는 계속 변함 (Gamma 때문에)
→ 매 순간 다시 헤지해야 함 (연속적 리밸런싱)

##### Step 5: Black-Scholes 유도의 핵심 논리

```
1. 포트폴리오: Π = V - Δ·S (옵션 + 주식 공매도)

2. 순간 변화: dΠ = dV - Δ·dS

3. Delta 헤지 (Δ = ∂V/∂S):
   → dS 항이 사라짐
   → 남는 건 dt 항뿐 (확정적)

4. 확정적 = 무위험
   → 무위험 이자율로 성장: dΠ = r·Π·dt

5. 정리하면 Black-Scholes PDE!
```

$$\frac{\partial V}{\partial t} + \frac{1}{2}\sigma^2 S^2 \frac{\partial^2 V}{\partial S^2} + rS\frac{\partial V}{\partial S} - rV = 0$$

---

### 문제에서 주어진 일반화된 형태

$$V_t + aV_{SS} + bV_S + cV = 0$$

Black-Scholes와 비교:
- $a = \frac{1}{2}\sigma^2 S^2$ (변동성 항)
- $b = rS$ (드리프트 항)
- $c = -r$ (할인 항)

---

## 🎯 PDE를 왜 수치적으로 푸나요?

### 공식이 있는 경우 vs 없는 경우

| 옵션 종류 | 공식 | 방법 |
|----------|-----|------|
| 유럽형 콜/풋 | ✅ 있음 | Black-Scholes 공식 |
| 미국형 | ❌ 없음 | FDM 등 수치해석 |
| 배리어 | △ 일부만 | FDM이 더 유연 |
| 아시안 | ❌ 없음 | FDM, 몬테카를로 |

**결론**: 복잡한 옵션은 **수치적 방법**이 필수!

---

## 🎯 FDM의 기본 아이디어

### 연속 → 이산 (격자로 쪼개기)

```
연속적인 세계:                  격자로 쪼갠 세계:

     V(S,t)                         v_i^k
       ↑                              ↑
       │   부드러운 곡면              │  ●──●──●──●
       │  ╱╲    ╱╲                   │  │  │  │  │
       │ ╱  ╲  ╱  ╲                  │  ●──●──●──●
       │╱    ╲╱    ╲                 │  │  │  │  │
       └─────────────→               │  ●──●──●──●
          S, t                       └─────────────→
                                        i (주가), k (시간)
```

### 격자 설정 자세히 보기

```
주가 S ↑
       │
S_max ─┼─●──●──●──●──●──●──●  i = N
       │  │  │  │  │  │  │  │
       │  ●──●──●──●──●──●──●  i = N-1
       │  │  │  │  │  │  │  │
       │  :  :  :  :  :  :  :
       │  │  │  │  │  │  │  │
       │  ●──●──●──●──●──●──●  i = 1
       │  │  │  │  │  │  │  │
S_min ─┼─●──●──●──●──●──●──●  i = 0
       │  │  │  │  │  │  │  │
       └──┴──┴──┴──┴──┴──┴──┴──→ 시간 t
          k=0  1  2  ...  M
          (T)            (0)
         만기           현재

💡 시간은 만기(T)에서 현재(0)로 역방향 계산!
   왜? 만기 때 옵션 가치는 알고 있으니까!
```

### 각 점의 의미

$$v_i^k = V(S_{min} + i \cdot \Delta S, \; T - k \cdot \Delta t)$$

- $i$: 주가 방향 인덱스 (0, 1, ..., N)
- $k$: 시간 방향 인덱스 (0, 1, ..., M)
- $v_i^k$: 격자점 $(i, k)$에서의 옵션 가치

---

## 🎯 Explicit vs Implicit

### Explicit (명시적 방법)

```
"과거(만기 쪽) 값들로 미래(현재 쪽) 값을 바로 계산"

시점 k (알고 있음):     ●───●───●
                         ↘  ↓  ↙
시점 k+1 (구하려는):        ●

→ 장점: 바로 계산 가능! (빠름)
→ 단점: Δt가 크면 발산할 수 있음 (불안정)
```

### Implicit (암묵적 방법) ⭐ 이 문제!

```
"현재 쪽 값들을 연립방정식으로 한꺼번에 계산"

시점 k (알고 있음):     ●───●───●
                         ↑  ↑  ↑
시점 k+1 (구하려는):    ?───?───?

→ 장점: 어떤 Δt를 써도 안정! (무조건 안정)
→ 단점: 연립방정식을 풀어야 함 (조금 느림)
```

### 왜 Implicit이 안정한가요?

```
비유: 등산

Explicit = 뒤만 보고 내려가기
  → 빠르지만, 경사가 급하면 굴러떨어질 수 있음

Implicit = 앞을 보면서 내려가기
  → 느리지만, 절대 안 넘어짐
```

---

## 💡 (1) 내부점 관계식 유도

> **📌 지금 뭘 구하나?**
>
> 내부점 $(1 \leq i \leq N-1)$에서 $v_i^{k+1}$과 $v_i^k$의 **관계식**
>
> 즉, "이전 시점 값 → 다음 시점 값" 연결하는 방정식!

### Step 1: 미분을 차분으로 바꾸기

**핵심 아이디어**: 미분 = 기울기 ≈ (값의 차이) / (간격)

#### 시간 미분 $V_t$

$$V_t \approx \frac{v_i^{k+1} - v_i^k}{\Delta t}$$

```
직관: "시간이 Δt 지났을 때 값이 얼마나 변했나"

       v_i^k (시점 k)
         │
         │ Δt 시간 후
         ↓
       v_i^{k+1} (시점 k+1)

기울기 = (나중 값 - 이전 값) / 시간간격
```

#### 공간 1차 미분 $V_S$ (중심차분)

$$V_S \approx \frac{v_{i+1}^{k+1} - v_{i-1}^{k+1}}{2\Delta S}$$

```
직관: "주가가 ΔS 다를 때 옵션값이 얼마나 다른가"

     v_{i-1}        v_i        v_{i+1}
        ●────────────●────────────●
      S-ΔS          S           S+ΔS

기울기 = (오른쪽 값 - 왼쪽 값) / (2 × 간격)
```

**왜 k+1 시점 값을 쓰나요?** → 이게 바로 **Implicit**의 특징!

#### 공간 2차 미분 $V_{SS}$ (중심차분)

$$V_{SS} \approx \frac{v_{i+1}^{k+1} - 2v_i^{k+1} + v_{i-1}^{k+1}}{(\Delta S)^2}$$

```
직관: "곡률 = 얼마나 휘어있나"

     v_{i-1}   v_i   v_{i+1}
        ●────────●────────●
          ╲      │      ╱
           ╲     │     ╱    ← 휘어진 정도
            ─────┴─────

곡률 = (왼쪽 + 오른쪽 - 2×중간) / 간격²

• 직선이면: 왼쪽 + 오른쪽 = 2×중간 → 곡률 = 0
• 위로 볼록: 중간이 높음 → 곡률 < 0
• 아래로 볼록: 중간이 낮음 → 곡률 > 0
```

---

### Step 2: PDE에 대입

원래 PDE:
$$V_t + aV_{SS} + bV_S + cV = 0$$

각 미분을 차분으로 대체:

$$\frac{v_i^{k+1} - v_i^k}{\Delta t} + a \cdot \frac{v_{i+1}^{k+1} - 2v_i^{k+1} + v_{i-1}^{k+1}}{(\Delta S)^2} + b \cdot \frac{v_{i+1}^{k+1} - v_{i-1}^{k+1}}{2\Delta S} + c \cdot v_i^{k+1} = 0$$

---

### Step 3: 계수 정의 (식을 간단하게)

복잡해 보이니까 새 기호를 정의:

$$\alpha = \frac{a \cdot \Delta t}{(\Delta S)^2}, \quad \beta = \frac{b \cdot \Delta t}{2\Delta S}, \quad \gamma = c \cdot \Delta t$$

**직관적 의미**:
- $\alpha$: 확산(변동성) 효과의 강도
- $\beta$: 드리프트 효과의 강도
- $\gamma$: 할인 효과의 강도

---

### Step 4: 정리하기

양변에 $\Delta t$를 곱하고 정리하면:

$$v_i^{k+1} - v_i^k + \alpha(v_{i+1}^{k+1} - 2v_i^{k+1} + v_{i-1}^{k+1}) + \beta(v_{i+1}^{k+1} - v_{i-1}^{k+1}) + \gamma v_i^{k+1} = 0$$

$v_i^k$를 오른쪽으로, k+1 시점 항들을 왼쪽으로 모으면:

$$(-\alpha + \beta)v_{i-1}^{k+1} + (1 + 2\alpha + \gamma)v_i^{k+1} + (-\alpha - \beta)v_{i+1}^{k+1} = v_i^k$$

---

### ✅ (1) 답

$$\boxed{(-\alpha + \beta)v_{i-1}^{k+1} + (1 + 2\alpha + \gamma)v_i^{k+1} + (-\alpha - \beta)v_{i+1}^{k+1} = v_i^k}$$

여기서:
- $\alpha = \frac{a \cdot \Delta t}{(\Delta S)^2}$
- $\beta = \frac{b \cdot \Delta t}{2\Delta S}$
- $\gamma = c \cdot \Delta t$

---

### 직관적 이해

```
이 식이 말하는 것:

"k+1 시점의 세 이웃 값을 적절히 조합하면 = k 시점의 중간 값"

  v_{i-1}^{k+1} ────── v_i^{k+1} ────── v_{i+1}^{k+1}
       ↑                  ↑                  ↑
    (-α+β)            (1+2α+γ)           (-α-β)
       │                  │                  │
       └──────────────────┼──────────────────┘
                          ‖
                       = v_i^k

→ 문제: k+1 시점 값들이 서로 엮여 있음!
→ 해결: 연립방정식으로 한꺼번에 풀기
```

---

## 💡 (2) 경계조건 $V_{SS} = 0$

> **📌 지금 뭘 구하나?**
>
> (1)의 관계식에는 $v_0$과 $v_N$ (경계값)이 포함됨
>
> 경계조건 $V_{SS} = 0$을 써서 **i=1과 i=N-1에서의 관계식**을 완성하라!
>
> ```
> i=1 관계식:   (??)v₀ + (??)v₁ + (??)v₂ = v₁ᵏ
>                 ↑
>            v₀를 v₁, v₂로 표현해서 없애기!
> ```

### $V_{SS} = 0$이 뭔 의미인가요?

**2차 미분이 0** = **곡률이 0** = **직선**

#### Step 1: 콜옵션이 뭔지부터

```
콜옵션 = "주식을 K원에 살 수 있는 쿠폰"

예: K = 100원짜리 콜옵션
= "삼성전자를 100원에 살 수 있는 권리"
```

**주가가 500원일 때, 이 쿠폰의 가치는?**

```
쿠폰 사용하면:
  100원 내고 → 500원짜리 주식을 받음

이득 = 500 - 100 = 400원

그러면 이 쿠폰의 가치 = 400원
```

**주가가 501원이 되면?**

```
쿠폰 사용하면:
  100원 내고 → 501원짜리 주식을 받음

이득 = 501 - 100 = 401원

쿠폰의 가치 = 401원
```

#### Step 2: 왜 옵션이 주가와 같이 움직이나?

```
쿠폰의 가치 = (받는 것) - (내는 것)
           = 주가 - 100원

주가가 1원 오르면 → 받는 것이 1원 늘어남 → 쿠폰 가치도 1원 오름
```

**비유: 치킨 할인 쿠폰**

```
"치킨을 10,000원에 살 수 있는 쿠폰"

치킨 정가 25,000원 → 쿠폰 가치 = 15,000원
치킨 정가 26,000원 → 쿠폰 가치 = 16,000원
치킨 정가 27,000원 → 쿠폰 가치 = 17,000원

치킨 가격 1,000원 오르면 쿠폰 가치도 1,000원 오름!
(어차피 10,000원만 내면 되니까)
```

#### Step 3: 단, "Deep ITM"일 때만!

```
Deep ITM (S=500, K=100):
  → 당연히 쿠폰 쓴다
  → 옵션 ≈ 주가 - 행사가
  → 주가 1원 오르면 옵션도 1원 (Delta ≈ 1)

ATM (S=100, K=100):
  → 쓸지 말지 애매함
  → 주가 1원 오르면 옵션 0.5원 (Delta ≈ 0.5)

OTM (S=50, K=100):
  → 쿠폰 안 쓸 거임
  → 주가 올라도 옵션 거의 안 변함 (Delta ≈ 0)
```

#### Step 4: 왜 직선인가?

```
Deep ITM에서:

주가 500원 → 옵션 ≈ 400원
주가 501원 → 옵션 ≈ 401원  (+1)
주가 502원 → 옵션 ≈ 402원  (+1)
주가 503원 → 옵션 ≈ 403원  (+1)

기울기가 항상 1로 일정 = 직선!
```

#### Step 5: 그래프로 보기

```
옵션 가격 V
     ↑
     │                         ╱ ← 기울기 = 1 (직선!)
     │                       ╱      Delta ≈ 1
     │                     ╱        Gamma ≈ 0
     │                   ╱
     │               ╭─╱  ← 곡선 (ATM 근처)
     │           ╭───╯      Delta 변함
     │       ────╯          Gamma ≠ 0
     │
     └─────────────────────────→ S
            K          Deep ITM (S >> K)
```

#### Step 6: 수학적 표현

$S \gg K$ (Deep In-The-Money)일 때:

$$V \approx S - Ke^{-rT}$$

미분하면:
$$\frac{\partial V}{\partial S} = \Delta \approx 1$$

$$\frac{\partial^2 V}{\partial S^2} = \Gamma \approx 0$$

**$\Gamma = 0$은 $V_{SS} = 0$과 같은 말!**

#### Step 7: 경계조건으로서의 의미

**"가정"이 아니라 "결과"입니다:**

```
V = S - K (Deep ITM에서)

1차 미분: V_S = 1      (기울기 = 1, 상수)
2차 미분: V_SS = 0     (상수를 미분하면 0)
```

```
FDM 격자의 경계 (S_max 근처):

S_max를 충분히 크게 잡으면
→ 그 근처에서는 무조건 Deep ITM
→ 무조건 V_SS ≈ 0 (수학적 결과)
→ 이 사실을 경계조건으로 표현!
```

**S가 매우 작을 때도 비슷:**
- 콜옵션 가치 ≈ 0 (행사 안 할 거니까)
- 거의 평평한 직선 → $V_{SS} \approx 0$

---

### i = 1 (하한 경계 근처) 처리

#### Step 1: 경계조건으로 $v_0$ 표현

$V_{SS} = 0$을 $i = 0$ (경계)에서 적용:

$$\frac{v_0^{k+1} - 2v_1^{k+1} + v_2^{k+1}}{(\Delta S)^2} = 0$$

정리하면:
$$v_0^{k+1} = 2v_1^{k+1} - v_2^{k+1}$$

**의미**: 경계값 $v_0$을 내부 값 $v_1, v_2$로 표현할 수 있음!

#### Step 2: 원래 관계식에 대입

$i = 1$에서의 관계식:
$$(-\alpha + \beta)v_0^{k+1} + (1 + 2\alpha + \gamma)v_1^{k+1} + (-\alpha - \beta)v_2^{k+1} = v_1^k$$

$v_0^{k+1} = 2v_1^{k+1} - v_2^{k+1}$ 대입:
$$(-\alpha + \beta)(2v_1^{k+1} - v_2^{k+1}) + (1 + 2\alpha + \gamma)v_1^{k+1} + (-\alpha - \beta)v_2^{k+1} = v_1^k$$

#### Step 3: 전개하고 정리

$v_1^{k+1}$ 계수:
$$2(-\alpha + \beta) + (1 + 2\alpha + \gamma) = -2\alpha + 2\beta + 1 + 2\alpha + \gamma = 1 + \gamma + 2\beta$$

$v_2^{k+1}$ 계수:
$$-(-\alpha + \beta) + (-\alpha - \beta) = \alpha - \beta - \alpha - \beta = -2\beta$$

### ✅ i = 1 답

$$\boxed{(1 + \gamma + 2\beta)v_1^{k+1} + (-2\beta)v_2^{k+1} = v_1^k}$$

---

### i = N-1 (상한 경계 근처) 처리

같은 방식으로 $V_{SS} = 0$을 $i = N$에서 적용:

$$v_N^{k+1} = 2v_{N-1}^{k+1} - v_{N-2}^{k+1}$$

이를 $i = N-1$ 관계식에 대입하면:

### ✅ i = N-1 답

$$\boxed{(-2\beta)v_{N-2}^{k+1} + (1 + \gamma - 2\beta)v_{N-1}^{k+1} = v_{N-1}^k}$$

---

## 💡 (3) Down-and-Out 배리어 옵션

> **📌 지금 뭘 구하나?**
>
> (2)와 같은 상황이지만, **경계조건이 다름**
>
> $S_{min}$이 녹아웃 배리어 → $v_0 = 0$
>
> 이 조건으로 **i=1에서의 관계식**을 구하라!

### 배리어 옵션이 뭔가요?

주가가 특정 가격(배리어)에 **닿으면 옵션이 사라지는** 특수 옵션

#### Down-and-Out 콜옵션 예시

```
조건:
  행사가 K = 100
  배리어 B = 80 (Down)

만기 전에...
  주가가 80 아래로 내려가면 → 옵션 소멸! (Out) 💀
  주가가 80 위에 있으면 → 옵션 유지 ✓
```

```
     주가
       ↑
  100 ─┼─────────╱╲─────╱╲─────────
       │        ╱  ╲   ╱  ╲
   90 ─┼───────╱────╲─╱────╲───────
       │      ╱      ╳      ╲
   80 ─┼─────╱───────────────╲───── ← 배리어
       │    ╱                 💥
   70 ─┼───╱                 (소멸!)
       │
       └────────────────────────────→ 시간
            시작               만기
```

### 왜 배리어 옵션을 쓰나요?

```
일반 콜옵션: 비쌈 💰💰💰
배리어 옵션: 저렴함 💰

→ "주가가 배리어까지 안 내려갈 거야"라고 생각하면
   더 싸게 옵션을 살 수 있음!
```

---

### 경계조건

$S_{min}$이 녹아웃 배리어이면:

$$v_0^{k+1} = 0 \quad \text{(모든 시점에서)}$$

**의미**: 배리어에 닿으면 옵션 가치가 즉시 **0**

---

### i = 1에서의 관계식

$v_0^{k+1} = 0$을 원래 관계식에 대입:

$$(-\alpha + \beta) \times 0 + (1 + 2\alpha + \gamma)v_1^{k+1} + (-\alpha - \beta)v_2^{k+1} = v_1^k$$

### ✅ (3) 답

$$\boxed{(1 + 2\alpha + \gamma)v_1^{k+1} + (-\alpha - \beta)v_2^{k+1} = v_1^k}$$

---

### 비교: 두 경계조건

| 경계조건 | $v_0$ 처리 | i=1 관계식 복잡도 |
|---------|----------|-----------------|
| $V_{SS} = 0$ | $v_0 = 2v_1 - v_2$ | 복잡 (대입 필요) |
| 배리어 (v₀=0) | $v_0 = 0$ | 단순 (항 사라짐) |

---

## 💡 전체 그림: 행렬 형태

모든 내부점의 관계식을 모으면 **삼중대각 연립방정식**:

$$\begin{pmatrix}
d_1 & u_1 & 0 & \cdots & 0 \\
l_2 & d_2 & u_2 & \cdots & 0 \\
0 & l_3 & d_3 & \cdots & 0 \\
\vdots & & \ddots & \ddots & u_{N-2} \\
0 & \cdots & 0 & l_{N-1} & d_{N-1}
\end{pmatrix}
\begin{pmatrix}
v_1^{k+1} \\ v_2^{k+1} \\ v_3^{k+1} \\ \vdots \\ v_{N-1}^{k+1}
\end{pmatrix}
=
\begin{pmatrix}
v_1^k \\ v_2^k \\ v_3^k \\ \vdots \\ v_{N-1}^k
\end{pmatrix}$$

```
삼중대각 행렬의 모습:

┌─────────────────────────┐
│ ■ ■ 0 0 0 0 0 0 0 0 0 0 │
│ ■ ■ ■ 0 0 0 0 0 0 0 0 0 │
│ 0 ■ ■ ■ 0 0 0 0 0 0 0 0 │
│ 0 0 ■ ■ ■ 0 0 0 0 0 0 0 │
│ 0 0 0 ■ ■ ■ 0 0 0 0 0 0 │
│           ...           │
│ 0 0 0 0 0 0 0 0 0 ■ ■ ■ │
│ 0 0 0 0 0 0 0 0 0 0 ■ ■ │
└─────────────────────────┘

→ Thomas 알고리즘으로 O(N)에 풀 수 있음!
```

---

## ✅ 최종 답안

### (1) 내부점 관계식

$$(-\alpha + \beta)v_{i-1}^{k+1} + (1 + 2\alpha + \gamma)v_i^{k+1} + (-\alpha - \beta)v_{i+1}^{k+1} = v_i^k$$

### (2) 경계조건 $V_{SS} = 0$

**i = 1**:
$$(1 + \gamma + 2\beta)v_1^{k+1} + (-2\beta)v_2^{k+1} = v_1^k$$

**i = N-1**:
$$(-2\beta)v_{N-2}^{k+1} + (1 + \gamma - 2\beta)v_{N-1}^{k+1} = v_{N-1}^k$$

### (3) Down-and-Out 배리어 (v₀ = 0)

$$(1 + 2\alpha + \gamma)v_1^{k+1} + (-\alpha - \beta)v_2^{k+1} = v_1^k$$

---

**작성일**: 2025-12-03
**과목**: 금융수치해석기법 기말고사 2024
